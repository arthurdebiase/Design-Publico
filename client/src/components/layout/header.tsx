import { Link, useLocation } from "wouter";
import { Button } from "@/components/ui/button";
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet";
import { Menu } from "lucide-react";
import { useTranslation } from 'react-i18next';
import { LanguageSelector } from "@/components/language-selector";
import { useQuery } from "@tanstack/react-query";

interface LogoResponse {
  url: string;
}

// Create a dedicated API hook for fetching the logo
function useBrandLogo() {
  return useQuery<LogoResponse>({
    queryKey: ['/api/brand/logo'],
    // The QueryClient default settings will handle the request
    retry: false, // Don't retry if it fails
    enabled: true, // Always try to fetch
  });
}

export default function Header() {
  const [location] = useLocation();
  const { t } = useTranslation();
  const { data: logoData, isLoading: isLogoLoading } = useBrandLogo();
  
  return (
    <header className="bg-white border-b border-gray-200 sticky top-0 z-10">
      <div className="container mx-auto px-4 md:px-6 py-4 flex items-center justify-between">
        <div className="flex items-center space-x-4">
          <Link href="/" className="flex items-center space-x-2">
            <div className="h-8 w-8 flex items-center justify-center">
              <div className="h-8 w-8 bg-[#13A15F] rounded-md flex items-center justify-center" style={{ backgroundColor: '#13A15F' }}>
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M25.3335 23.9998C28.0668 23.9998 28.0668 23.9998 28.0668 21.3332V10.6665C28.0668 7.99984 28.0668 7.99984 25.3335 7.99984H6.66683C4.00016 7.99984 4.00016 7.99984 4.00016 10.6665V21.3332C4.00016 23.9998 4.00016 23.9998 6.66683 23.9998H25.3335Z" fill="#13A15F"/>
                  <path d="M22.5 20.0402L22.4792 20.0519C22.125 20.3077 21.6875 20.5714 21.2708 20.8272L21.2292 20.8428C20.8333 21.1064 20.4167 21.3779 20 21.6494L19.9896 21.6495C19.5521 21.9361 19.1354 22.2071 18.6771 22.4635L18.6562 22.4716C18.1354 22.7507 17.625 23.0064 17.0833 23.2386C14.4583 24.2507 11.7708 24.3857 9.0625 23.5714C7.33333 23.0519 6.07708 22.1532 5.47917 20.8507L5.55729 20.7819C5.88021 20.5166 6.25521 20.24 6.65625 19.9712L6.69792 19.9478C7.07292 19.6998 7.48438 19.4439 7.89583 19.1878C8.34375 18.9006 8.77084 18.6213 9.20834 18.3342C9.64584 18.0471 10.0833 17.7521 10.5417 17.457C11 17.1621 11.4583 16.8584 11.9375 16.5547C12.4167 16.251 12.9062 15.9394 13.4167 15.6278L13.9167 15.3162C13.9687 15.2834 14.0312 15.2428 14.0938 15.2107L14.2708 15.1202L14.6562 14.9151L14.7917 14.8404C14.8125 14.8246 14.8333 14.8089 14.8542 14.7931C14.875 14.7851 14.8958 14.7696 14.9167 14.7619C15.0312 14.6951 15.1458 14.6359 15.25 14.5615C15.2917 14.5376 15.3542 14.5056 15.3958 14.474L15.4375 14.4584C16 14.1391 16.5417 13.7987 17.0833 13.4816C17.625 13.1487 18.0833 12.8369 18.4792 12.5889C18.8958 12.3165 19.1875 12.1034 19.375 11.9379L19.7708 11.6583C19.7917 11.6509 19.8125 11.6272 19.8333 11.6195C20.0417 11.4936 20.25 11.3444 20.4583 11.2032C21.0625 10.8379 21.6458 10.4806 22.2083 10.1468L22.2917 10.1072C22.8542 9.76533 23.4167 9.45763 23.9583 9.18654L24.0833 9.12741C24.125 9.10976 24.1667 9.08446 24.1875 9.06676C24.2083 9.06684 24.2395 9.04154 24.2708 9.03141L24.3229 9.01376C25.2396 8.67111 26.3021 9.50298 26.2604 10.4886L26.25 10.9454C26.25 10.9924 26.25 11.0551 26.25 11.1021C26.25 11.1098 26.25 11.1254 26.25 11.1334C26.25 11.2718 26.25 11.4136 26.25 11.5444V20.1084C26.25 20.1632 26.25 20.218 26.25 20.2728V20.3905L26.2396 20.5639C26.2396 20.596 26.2396 20.6213 26.2292 20.6531L26.2188 20.7082C26.0937 21.6309 25.0104 22.1911 24.1667 21.7743L24.125 21.7505C23.5833 21.4571 23.0417 21.1487 22.5 20.8403V20.0402Z" fill="#F5DEA1"/>
                  <path d="M22.4998 20.8428V20.0428C21.958 19.7344 21.4164 19.4259 20.8539 19.1328L20.8127 19.1172C20.2498 18.8323 19.6873 18.5476 19.1248 18.2787L18.9998 18.2161C18.958 18.1984 18.9164 18.1808 18.8955 18.1647C18.7498 18.0913 18.6041 18.0095 18.4539 17.9276C17.8955 17.624 17.3416 17.3289 16.8164 17.0182C16.2539 16.6932 15.7373 16.3761 15.2789 16.0746L15.2164 16.0428C15.1955 16.0274 15.1746 16.0197 15.1537 16.0042L14.9998 15.918C14.958 15.8918 14.9164 15.8676 14.8746 15.8437L14.7998 15.8016C14.7789 15.7861 14.7539 15.7703 14.7331 15.7546C14.6705 15.7192 14.6081 15.6838 14.5498 15.6408C14.0705 15.3371 13.5914 15.0256 13.1123 14.7062C12.6331 14.3945 12.1748 14.0749 11.7166 13.7632C11.2584 13.4516 10.8209 13.1321 10.4166 12.8125C10.0121 12.5006 9.61714 12.1811 9.25464 11.8694C8.89214 11.5498 8.55464 11.2381 8.26298 10.9186C7.97131 10.599 7.71423 10.2952 7.52298 9.9835C7.31298 9.64745 7.18756 9.31141 7.16256 8.98303C7.16214 8.97537 7.16214 8.96694 7.15423 8.95852L7.13756 8.89172C7.04173 8.32422 7.24173 7.76437 7.67923 7.2887L7.77506 7.18812C7.79173 7.17047 7.80381 7.14434 7.81589 7.12671C7.82798 7.10908 7.84964 7.09903 7.88673 7.06523C8.11298 6.88192 8.38881 6.71628 8.68881 6.57323L8.81423 6.51407L8.89214 6.4783L8.98798 6.45302C9.78798 6.25187 10.6039 6.56717 11.183 7.30187L11.3039 7.45251C11.6664 7.90387 12.0122 8.38207 12.3623 8.87794L12.3831 8.90316C12.7373 9.41516 13.0914 9.9595 13.4416 10.5194L13.633 10.8554L13.7997 11.129C13.9456 11.3983 14.0955 11.6716 14.2498 11.941C14.3997 12.2141 14.5498 12.4873 14.7038 12.7446L14.8414 12.9596C14.858 12.9831 14.8748 13.0067 14.8831 13.0228L14.9373 13.1073C14.9623 13.1427 14.9872 13.178 15.0121 13.2211L15.2914 13.6802L15.3039 13.7038C15.3248 13.7349 15.3456 13.766 15.3665 13.7893L15.3997 13.836L15.4539 13.9042C15.475 13.9353 15.4958 13.9664 15.5166 13.9897C15.5373 14.0169 15.5581 14.0403 15.5789 14.0636C15.6206 14.1103 15.6623 14.1571 15.7038 14.2039C15.7248 14.2311 15.7539 14.2622 15.7831 14.2973C15.8039 14.3207 15.8248 14.3518 15.8456 14.3749C15.8664 14.3982 15.8873 14.4294 15.9081 14.4525C15.9289 14.4837 15.9498 14.507 15.9789 14.538C16.0081 14.5691 16.039 14.5924 16.0684 14.6235C16.0893 14.6467 16.1184 14.6778 16.1393 14.7011C16.1685 14.7322 16.1893 14.7632 16.2184 14.7867C16.2393 14.8099 16.2684 14.8411 16.2893 14.8642C16.3393 14.9186 16.3893 14.9652 16.4414 15.0119C16.4622 15.0351 16.4914 15.0584 16.5122 15.0816C16.5539 15.1283 16.5956 15.1673 16.6456 15.2142C16.6664 15.2375 16.6955 15.2607 16.7164 15.284C16.8164 15.3775 16.9165 15.4633 17.0165 15.5487C17.0581 15.5877 17.0998 15.6267 17.1498 15.6657C17.166 15.6811 17.1913 15.7041 17.2166 15.725L17.266 15.764C17.4247 15.8886 17.5913 16.0055 17.7622 16.1146L17.8122 16.1458C17.8539 16.1848 17.9037 16.2157 17.9455 16.2547L18.0789 16.3481C18.158 16.4104 18.2413 16.465 18.3164 16.5273C18.4747 16.6363 18.633 16.7531 18.7913 16.87C18.808 16.8855 18.8247 16.901 18.8414 16.9164L18.9163 16.9788C18.9788 17.0255 19.0413 17.0723 19.1038 17.1191C19.3913 17.3222 19.6788 17.5253 19.958 17.7362C20.233 17.9472 20.5038 18.1581 20.7788 18.3847L20.8996 18.4782C21.4663 18.9296 22.0329 19.407 22.5996 19.9C22.5413 20.1892 22.4996 20.4947 22.4998 20.8428Z" fill="#FEFDFA"/>
                </svg>
              </div>
            </div>
            <span className="flex items-center">
              <span style={{ fontFamily: 'Arial Black, Arial', fontWeight: 900 }}>DESIGN</span>
              <span style={{ fontFamily: 'Arial', fontWeight: 700 }} className="ml-1">PÃšBLICO</span>
            </span>
          </Link>
        </div>
        
        {/* Navigation (Desktop) */}
        <nav className="hidden md:flex items-center space-x-6">
          <Link href="/" className={`text-[#333333] hover:text-[#0066FF] font-medium ${location === '/' ? 'text-[#0066FF]' : ''}`}>
            {t('header.apps')}
          </Link>
          <Link href="/screens" className={`text-[#333333] hover:text-[#0066FF] font-medium ${location === '/screens' ? 'text-[#0066FF]' : ''}`}>
            {t('header.screens')}
          </Link>
          <Link href="/about" className={`text-[#333333] hover:text-[#0066FF] font-medium ${location === '/about' ? 'text-[#0066FF]' : ''}`}>
            {t('header.about')}
          </Link>
          <Button className="bg-[#0066FF] hover:bg-blue-700 text-white">
            {t('header.requestApp')}
          </Button>
        </nav>
        
        {/* Mobile Menu */}
        <div className="md:hidden flex items-center space-x-2">
          <Sheet>
            <SheetTrigger asChild>
              <Button variant="ghost" size="icon">
                <Menu className="h-6 w-6" />
              </Button>
            </SheetTrigger>
            <SheetContent>
              <div className="mt-8 flex flex-col space-y-4">
                <Link href="/" className="text-lg font-medium hover:text-[#0066FF]">
                  {t('header.apps')}
                </Link>
                <Link href="/screens" className="text-lg font-medium hover:text-[#0066FF]">
                  {t('header.screens')}
                </Link>
                <Link href="/about" className="text-lg font-medium hover:text-[#0066FF]">
                  {t('header.about')}
                </Link>
                <Button className="bg-[#0066FF] hover:bg-blue-700 text-white mt-4">
                  {t('header.requestApp')}
                </Button>
              </div>
            </SheetContent>
          </Sheet>
        </div>
      </div>
    </header>
  );
}
